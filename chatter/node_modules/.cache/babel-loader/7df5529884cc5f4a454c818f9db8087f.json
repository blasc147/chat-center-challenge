{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState, useCallback } from 'react';\nimport io from 'socket.io-client';\nimport useSound from 'use-sound';\nimport config from '../config';\nimport initialMessage from '../common/constants/initialCarolMessage';\nimport axios from 'axios';\nconst socket = io(config.BOT_SERVER_ENDPOINT, {\n  transports: ['websocket', 'polling', 'flashsocket']\n});\nconst initialCarolMessage = {\n  user: 'bot',\n  message: initialMessage,\n  id: Date.now()\n};\nexport default function useChat(selectedUser) {\n  _s();\n  const [playSend] = useSound(config.SEND_AUDIO_URL);\n  const [playReceive] = useSound(config.RECEIVE_AUDIO_URL);\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState('');\n  const [botTyping, setBotTyping] = useState(false);\n  useEffect(() => {\n    if (selectedUser) {\n      async function fetchMessages() {\n        const response = await axios.get(`${config.BOT_SERVER_ENDPOINT}/api/chats/${selectedUser}`);\n        setMessages(response.data.messages);\n      }\n      fetchMessages();\n    }\n  }, [selectedUser]);\n  useEffect(() => {\n    socket.on('connect', () => {\n      console.log('Connected to the server');\n    });\n    socket.on('bot-message', botMessage => {\n      console.log('Received bot message:', botMessage);\n      setMessages(prevMessages => [...prevMessages, {\n        user: 'bot',\n        message: botMessage,\n        id: Date.now()\n      }]);\n      setBotTyping(false);\n      playReceive();\n    });\n    socket.on('bot-typing', () => {\n      console.log('Bot is typing');\n      setBotTyping(true);\n    });\n    socket.on('disconnect', () => {\n      console.log('Disconnected from the server');\n    });\n    return () => {\n      socket.off('connect');\n      socket.off('bot-message');\n      socket.off('bot-typing');\n      socket.off('disconnect');\n    };\n  }, [playReceive]);\n  const sendMessage = useCallback(() => {\n    if (message.trim()) {\n      const userMessage = {\n        user: 'me',\n        message: message.trim(),\n        id: Date.now()\n      };\n      console.log('Sending user message:', userMessage);\n      setMessages(prevMessages => [...prevMessages, userMessage]);\n      setMessage('');\n      playSend();\n      socket.emit('user-message', message.trim());\n    }\n  }, [message, playSend]);\n  const onChangeMessage = e => {\n    setMessage(e.target.value);\n  };\n  useEffect(() => {\n    const messageList = document.getElementById('message-list');\n    if (messageList) {\n      messageList.scrollTop = messageList.scrollHeight;\n    }\n  }, [messages]);\n  return {\n    messages,\n    message,\n    botTyping,\n    sendMessage,\n    onChangeMessage\n  };\n}\n_s(useChat, \"ub7UhIB5zMC6PoF69vLhaOwYUSc=\", false, function () {\n  return [useSound, useSound];\n});","map":{"version":3,"names":["useEffect","useState","useCallback","io","useSound","config","initialMessage","axios","socket","BOT_SERVER_ENDPOINT","transports","initialCarolMessage","user","message","id","Date","now","useChat","selectedUser","_s","playSend","SEND_AUDIO_URL","playReceive","RECEIVE_AUDIO_URL","messages","setMessages","setMessage","botTyping","setBotTyping","fetchMessages","response","get","data","on","console","log","botMessage","prevMessages","off","sendMessage","trim","userMessage","emit","onChangeMessage","e","target","value","messageList","document","getElementById","scrollTop","scrollHeight"],"sources":["/home/blas/Music/chatcenter-js-coding-challenge-1/chatter/src/hooks/useChat.js"],"sourcesContent":["import { useEffect, useState, useCallback } from 'react'\nimport io from 'socket.io-client'\nimport useSound from 'use-sound'\nimport config from '../config'\nimport initialMessage from '../common/constants/initialCarolMessage'\nimport axios from 'axios'\n\nconst socket = io(config.BOT_SERVER_ENDPOINT, {\n  transports: ['websocket', 'polling', 'flashsocket']\n})\n\nconst initialCarolMessage = {\n  user: 'bot',\n  message: initialMessage,\n  id: Date.now()\n}\n\nexport default function useChat(selectedUser) {\n  const [playSend] = useSound(config.SEND_AUDIO_URL)\n  const [playReceive] = useSound(config.RECEIVE_AUDIO_URL)\n  const [messages, setMessages] = useState([])\n  const [message, setMessage] = useState('')\n  const [botTyping, setBotTyping] = useState(false)\n\n  useEffect(() => {\n    if (selectedUser) {\n      async function fetchMessages() {\n        const response = await axios.get(\n          `${config.BOT_SERVER_ENDPOINT}/api/chats/${selectedUser}`\n        )\n        setMessages(response.data.messages)\n      }\n      fetchMessages()\n    }\n  }, [selectedUser])\n\n  useEffect(() => {\n    socket.on('connect', () => {\n      console.log('Connected to the server')\n    })\n\n    socket.on('bot-message', (botMessage) => {\n      console.log('Received bot message:', botMessage)\n      setMessages((prevMessages) => [\n        ...prevMessages,\n        { user: 'bot', message: botMessage, id: Date.now() }\n      ])\n      setBotTyping(false)\n      playReceive()\n    })\n\n    socket.on('bot-typing', () => {\n      console.log('Bot is typing')\n      setBotTyping(true)\n    })\n\n    socket.on('disconnect', () => {\n      console.log('Disconnected from the server')\n    })\n\n    return () => {\n      socket.off('connect')\n      socket.off('bot-message')\n      socket.off('bot-typing')\n      socket.off('disconnect')\n    }\n  }, [playReceive])\n\n  const sendMessage = useCallback(() => {\n    if (message.trim()) {\n      const userMessage = {\n        user: 'me',\n        message: message.trim(),\n        id: Date.now()\n      }\n      console.log('Sending user message:', userMessage)\n      setMessages((prevMessages) => [...prevMessages, userMessage])\n      setMessage('')\n      playSend()\n\n      socket.emit('user-message', message.trim())\n    }\n  }, [message, playSend])\n\n  const onChangeMessage = (e) => {\n    setMessage(e.target.value)\n  }\n\n  useEffect(() => {\n    const messageList = document.getElementById('message-list')\n    if (messageList) {\n      messageList.scrollTop = messageList.scrollHeight\n    }\n  }, [messages])\n\n  return {\n    messages,\n    message,\n    botTyping,\n    sendMessage,\n    onChangeMessage\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}